{% extends "base.html" %}

{% block meta %}
<title>Shopping List</title>
{% endblock meta %}

{% block content %}
<h1>Shopping List Page</h1>
<h5>Name:</h5>
<p>{{ name }}</p>
<h5>Class:</h5>
<p>{{ class }}</p>
<table id="product_table">
    <tr>
        <th>Name</th>
        <th>Price</th>
        <th>Description</th>
        <th>Date Added</th>
    </tr>
    {% comment %} Some comments ... {% endcomment %}
    {% for product in products %}
    <tr>
        <td>{{ product.name }}</td>
        <td>{{ product.price }}</td>
        <td>{{ product.description }}</td>
        <td>{{ product.date_added }}</td>
    </tr>
    {% endfor %}
</table>

<br />

<a href="{% url 'main:create_product' %}">
    <button>
        Add New Product
    </button>
</a>

<a href="{% url 'main:logout' %}">
    <button>
        Logout
    </button>
</a>

<h5>Last login session: {{ last_login }}</h5>

<script>
    const getProducts = async () => {
        return fetch("{% url 'main:show_json' %}").then((response) => { return response.json() })
    }

    const refreshProducts = async () => {
        document.getElementById("product_table").innerHTML = ""
        const products = await getProducts()

        let htmlString = `
        <tr>
            <th>Name</th>
            <th>Price</th>
            <th>Description</th>
            <th>Date Added</th>
        </tr>`

        products.forEach((product) => {
            htmlString += `\n
            <tr>
                <td>${product.fields.name}</td>
                <td>${product.fields.price}</td>
                <td>${product.fields.description}</td>
                <td>${product.fields.date_added}</td>
            </tr>`
        })

        document.getElementById("product_table").innerHTML = htmlString
    }

    refreshProducts()
</script>

{% endblock content %}
